<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Team Daily Report</title>
    <link
      rel="icon"
      type="image"
      href="https://ziagroup.org/wp-content/uploads/2023/01/IMG_7866.png"
    />
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20;
      }
      .container {
        background: white;
        padding: 20px;
        border-radius: 10px;
        max-width: 900px;
        margin: auto;
      }
      .employee-section {
        border: 1px solid #ccc;
        padding: 10px;
        margin-bottom: 15px;
        border-radius: 8px;
      }
      .buttons {
        margin-top: 20px;
      }
      textarea {
        width: 100%;
        height: 200px;
      }
      select.workType.leave {
        background-color: red;
        color: white;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <img
        src="https://ziagroup.org/wp-content/uploads/2023/01/IMG_7866.png"
        alt="zia"
        height="150px"
      />
      <h2>
        Zia-Telecalling Employee Daily Report
        <h5>(App Made with ‚ù§Ô∏è by Faisal)</h5>
      </h2>
      <label
        >Team Name:
        <select id="teamName">
          <option value="A">A</option>
          <option value="B">B</option>
          <option value="C">C</option>
          <option value="D">D</option>
        </select> </label
      ><br /><br />
      <label>Date: <input type="date" id="reportDate" /> </label><br /><br />
      <div id="employeeContainer"></div>
      <button onclick="addEmployee()">Add Employee</button>
      <div class="buttons">
        <button onclick="generateReport()">Generate Report</button>
        <button onclick="copyReport()">Copy Report</button>
        <button onclick="shareWhatsApp()">Share via WhatsApp</button>
        <button onclick="submitToGoogleSheets()">
          Submit to Google Sheets
        </button>
      </div>
      <br />
      <textarea id="reportOutput" readonly></textarea>
    </div>

    <script>
      let employeeCount = 0;
      const employeeContainer = document.getElementById("employeeContainer");

      function addEmployee() {
        employeeCount++;
        const div = document.createElement("div");
        div.className = "employee-section";
        div.innerHTML = `
    <h3>Employee ${employeeCount}</h3>
    <label>Name: <input type="text" class="name" /></label><br/>
    <label>Work Type:
      <select class="workType" onchange="toggleFields(this)">
        <option value="Work From Office">Work From Office</option>
        <option value="Work From Home">Work From Home</option>
        <option value="Leave">Leave</option>
      </select>
    </label><br/><br/>
    <div class="details">
      <label>Login: <input type="time" class="login" /></label><br/>
      <label>Logout: <input type="time" class="logout" /></label><br/>
      <label>Project Area: <input type="text" class="projectArea" /></label><br/>
      <label>New Calls: <input type="number" class="calls" /></label>
      <label>Follow-ups: <input type="number" class="followUps" /></label><br/>
      <label>Interested Leads: <input type="number" class="interestedLeads" /></label><br/>

      <label>Students Visited Today:</label><textarea Placeholder="for e.g. FAISAL-9945XXXXXX"class="visitedToday"></textarea><br/>
      <label>Students Visiting Tomorrow:</label><textarea Placeholder="for e.g. FAISAL-9945XXXXXX" class="visitingTomorrow"></textarea><br/>
      <label>Yesterday's Leads:</label><input type="number" class="yesterdaysLeads" /><br/>
      <label>Students Visited Yesterday:</label><textarea Placeholder="for e.g. FAISAL-9945XXXXXX" class="yesterdaysVisited"></textarea><br/>
    </div>
  `;
        employeeContainer.appendChild(div);
      }

      function toggleFields(selectElement) {
        const section = selectElement.closest(".employee-section");
        const detailsDiv = section.querySelector(".details");
        const inputs = detailsDiv.querySelectorAll("input, textarea");

        if (selectElement.value === "Leave") {
          detailsDiv.style.display = "none";
          inputs.forEach((input) => (input.disabled = true));
          selectElement.classList.add("leave");
        } else {
          detailsDiv.style.display = "block";
          inputs.forEach((input) => (input.disabled = false));
          selectElement.classList.remove("leave");
        }
      }

      function generateReport() {
        const teamName = document.getElementById("teamName").value;
        const date = document
          .getElementById("reportDate")
          .value.split("-")
          .reverse()
          .join("-");
        const reportLines = [
          `\nüìÖ Date : *${date}*\n`,
        ];

        const employeeSections = document.querySelectorAll(".employee-section");
        employeeSections.forEach((section) => {
          const name = section.querySelector(".name").value;
          const workType = section.querySelector(".workType").value;

          reportLines.push(`*Employee Name* : *${name}* \n(${workType})`);

          if (workType === "Leave") {
            reportLines.push(
              `üõë *${name}* is on Leave on *${date}*.\n----------------------\n`
            );
            return;
          }

          const login = formatTime(section.querySelector(".login").value);
          const logout = formatTime(section.querySelector(".logout").value);
          const projectArea = section.querySelector(".projectArea").value;
          const calls = section.querySelector(".calls").value;
          const followUps = section.querySelector(".followUps").value;
          const interestedLeads =
            section.querySelector(".interestedLeads").value;
          const visitedToday = section
            .querySelector(".visitedToday")
            .value.split("\n")
            .filter((s) => s.trim());
          const visitingTomorrow = section
            .querySelector(".visitingTomorrow")
            .value.split("\n")
            .filter((s) => s.trim());
          const yesterdaysLeads =
            section.querySelector(".yesterdaysLeads").value;
          const yesterdaysVisited = section
            .querySelector(".yesterdaysVisited")
            .value.split("\n")
            .filter((s) => s.trim());

          reportLines.push(`üü¢ Login : *${login}*\nüî¥ Logout : *${logout}*`);
          reportLines.push(
            `‚¶ø Worked on *${projectArea}* Data. Completed *${calls}* New calls and *${followUps}* follow ups.`
          );
          reportLines.push(
            `‚¶ø Total No. of Interested leads : *${interestedLeads}*`
          );
          reportLines.push(
            `‚¶ø No. of Students Visited today : *${visitedToday.length}*`
          );
          visitedToday.forEach((s, i) => reportLines.push(`${i + 1}. *${s}*`));
          reportLines.push(
            `‚¶ø No. of Students Visiting Tomorrow : *${visitingTomorrow.length}*`
          );
          visitingTomorrow.forEach((s, i) =>
            reportLines.push(`${i + 1}. *${s}*`)
          );
          reportLines.push(`‚¶ø No. of Yesterday's Leads : *${yesterdaysLeads}*`);
          yesterdaysVisited.forEach((s, i) =>
            reportLines.push(`${i + 1}. *${s}*`)
          );
          reportLines.push(
            `\nThanks and Regards,\n*${name}*\n----------------------\n`
          );
        });

        document.getElementById("reportOutput").value = reportLines.join("\n");
      }

      function formatTime(time24) {
        if (!time24) return "";
        const [hour, minute] = time24.split(":");
        const h = parseInt(hour);
        const suffix = h >= 12 ? "PM" : "AM";
        const hour12 = ((h + 11) % 12) + 1;
        return `${hour12}:${minute} ${suffix}`;
      }

      function copyReport() {
        const report = document.getElementById("reportOutput").value;
        navigator.clipboard
          .writeText(report)
          .then(() => alert("Report copied!"));
      }

      function shareWhatsApp() {
        const text = encodeURIComponent(
          document.getElementById("reportOutput").value
        );
        window.open(`https://wa.me/?text=${text}`, "_blank");
      }

      function submitToGoogleSheets() {
        const teamName = document.getElementById("teamName").value;
        const date = document
          .getElementById("reportDate")
          .value.split("-")
          .reverse()
          .join("-");
        const employees = [];

        const sections = document.querySelectorAll(".employee-section");
        sections.forEach((section) => {
          const workType = section.querySelector(".workType").value;
          const details = section.querySelector(".details");
          const disabled = workType === "Leave";

          employees.push({
            name: section.querySelector(".name").value,
            workType,
            login: disabled
              ? ""
              : formatTime(section.querySelector(".login").value),
            logout: disabled
              ? ""
              : formatTime(section.querySelector(".logout").value),
            projectArea: disabled
              ? ""
              : section.querySelector(".projectArea").value,
            calls: disabled ? "" : section.querySelector(".calls").value,
            followUps: disabled
              ? ""
              : section.querySelector(".followUps").value,
            interestedLeads: disabled
              ? ""
              : section.querySelector(".interestedLeads").value,
            visitedToday: disabled
              ? []
              : section
                  .querySelector(".visitedToday")
                  .value.split("\n")
                  .filter((s) => s.trim()),
            visitingTomorrow: disabled
              ? []
              : section
                  .querySelector(".visitingTomorrow")
                  .value.split("\n")
                  .filter((s) => s.trim()),
            yesterdaysLeads: disabled
              ? ""
              : section.querySelector(".yesterdaysLeads").value,
            yesterdaysVisited: disabled
              ? []
              : section
                  .querySelector(".yesterdaysVisited")
                  .value.split("\n")
                  .filter((s) => s.trim()),
          });
        });

        const payload = { teamName, date, employees };

        fetch(
          "https://script.google.com/macros/s/AKfycbyJ3msCQHvDrusPESCpnEiDJWbN0VxqTnoP4A9eZa-zkzkdO-o0cJvC0VPwegY6JxWavg/exec",
          {
            method: "POST",
            mode: "no-cors",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          }
        ).then(() => alert("Data submitted to Google Sheets!"));
      }

      addEmployee();
    </script>
    <div class="footr"><h3>Made with ‚ù§Ô∏è by Faisal</h3></div>
  </body>
</html>
